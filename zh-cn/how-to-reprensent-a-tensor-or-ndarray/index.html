<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Pytorch å¼ é‡çš„ strides æ ¼å¼æ˜¯ä»€ä¹ˆ - MartinLwx&#39;s Blog</title><meta name="description" content="ä»‹ç»äº† Pytorch çš„å¼ é‡çš„ strides æ ¼å¼åŸç†"><meta property="og:title" content="Pytorch å¼ é‡çš„ strides æ ¼å¼æ˜¯ä»€ä¹ˆ" />
<meta property="og:description" content="ä»‹ç»äº† Pytorch çš„å¼ é‡çš„ strides æ ¼å¼åŸç†" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://martinlwx.github.io/zh-cn/how-to-reprensent-a-tensor-or-ndarray/" /><meta property="og:image" content="https://martinlwx.github.io/logo.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-14T15:26:16+08:00" />
<meta property="article:modified_time" content="2023-07-14T15:26:16+08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://martinlwx.github.io/logo.png" /><meta name="twitter:title" content="Pytorch å¼ é‡çš„ strides æ ¼å¼æ˜¯ä»€ä¹ˆ"/>
<meta name="twitter:description" content="ä»‹ç»äº† Pytorch çš„å¼ é‡çš„ strides æ ¼å¼åŸç†"/>
<meta name="application-name" content="MartinLwx&#39;s blog">
<meta name="apple-mobile-web-app-title" content="MartinLwx&#39;s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://martinlwx.github.io/zh-cn/how-to-reprensent-a-tensor-or-ndarray/" /><link rel="prev" href="https://martinlwx.github.io/zh-cn/how-to-memorize-insertion-and-deletion-in-rb-tree/" /><link rel="next" href="https://martinlwx.github.io/zh-cn/a-trick-to-calculating-partial-derivatives-in-ml/" /><link rel="stylesheet" href="/css/page.min.css"><link rel="stylesheet" href="/css/home.min.css">
        <link href="https://www.googletagmanager.com" rel="preconnect" crossorigin>
        <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Pytorch å¼ é‡çš„ strides æ ¼å¼æ˜¯ä»€ä¹ˆ",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/martinlwx.github.io\/zh-cn\/how-to-reprensent-a-tensor-or-ndarray\/"
        },"genre": "posts","keywords": "Internal, Pytorch, Deep-Learning","wordcount":  4007 ,
        "url": "https:\/\/martinlwx.github.io\/zh-cn\/how-to-reprensent-a-tensor-or-ndarray\/","datePublished": "2023-07-14T15:26:16+08:00","dateModified": "2023-07-14T15:26:16+08:00","license": "\u003ca rel=\"license noopener\" href=\"https://creativecommons.org/licenses/by-nc-nd/4.0/\" target=\"_blank\"\u003eCC BY-NC-ND 4.0\u003c/a\u003e","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "MartinLwx"
            },"description": "ä»‹ç»äº† Pytorch çš„å¼ é‡çš„ strides æ ¼å¼åŸç†"
    }
    </script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7RY6742J2F"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-7RY6742J2F', { 'anonymize_ip': false });
}
</script>
</head><body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/zh-cn/" title="MartinLwx&#39;s Blog">MartinLwx&#39;s blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/zh-cn/posts/"> æ‰€æœ‰æ–‡ç«  </a><a class="menu-item" href="/zh-cn/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/zh-cn/categories/"> åˆ†ç±» </a><a class="menu-item" href="https://github.com/MartinLwx" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fa-brands fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item language" title="é€‰æ‹©è¯­è¨€">ç®€ä½“ä¸­æ–‡<i class="fa-solid fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/en/how-to-reprensent-a-tensor-or-ndarray/">English</option><option value="/zh-cn/how-to-reprensent-a-tensor-or-ndarray/" selected>ç®€ä½“ä¸­æ–‡</option></select>
                    </span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="#" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fa-solid fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fa-solid fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fa-solid fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a class="menu-item" href="/index.xml" title="RSS"><i class="fa-solid fa-rss fa-fw" title="RSS"></i> </a><a href="#" onclick="return false;" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fa-solid fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/zh-cn/" title="MartinLwx&#39;s Blog">MartinLwx&#39;s blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="#" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fa-solid fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fa-solid fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fa-solid fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/zh-cn/posts/" title="">æ‰€æœ‰æ–‡ç« </a><a class="menu-item" href="/zh-cn/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/zh-cn/categories/" title="">åˆ†ç±»</a><a class="menu-item" href="https://github.com/MartinLwx" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fa-brands fa-github fa-fw'></i></a><div class="menu-item"><a href="/index.xml" title="RSS"><i class="fa-solid fa-rss fa-fw" title="RSS"></i> </a>
                <span>&nbsp;|&nbsp;</span><a href="#" onclick="return false;" class="theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fa-solid fa-adjust fa-fw"></i>
                </a>
            </div><span class="menu-item language" title="é€‰æ‹©è¯­è¨€">ç®€ä½“ä¸­æ–‡<i class="fa-solid fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/en/how-to-reprensent-a-tensor-or-ndarray/">English</option><option value="/zh-cn/how-to-reprensent-a-tensor-or-ndarray/" selected>ç®€ä½“ä¸­æ–‡</option></select>
                </span></div>
    </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single" data-toc="enable"><div class="single-card" ><h2 class="single-title animated flipInX">Pytorch å¼ é‡çš„ strides æ ¼å¼æ˜¯ä»€ä¹ˆ</h2><div class="post-meta">
                <div class="post-meta-line"><span class="post-author"><a href="/zh-cn/" title="Author" rel=" author" class="author"><i class="fa-solid fa-user-circle fa-fw"></i>MartinLwx</a></span>&nbsp;<span class="post-category">å‡ºç‰ˆäº  <a href="/zh-cn/categories/ml-dl/"><i class="fa-regular fa-folder fa-fw"></i>ML-DL</a>&nbsp;<a href="/zh-cn/categories/internal/"><i class="fa-regular fa-folder fa-fw"></i>Internal</a></span></div>
                <div class="post-meta-line"><span><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-07-14">2023-07-14</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 4007 å­—</span>&nbsp;
                    <span><i class="fa-regular fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 8 åˆ†é’Ÿ</span>&nbsp;</div>
            </div>
            
            <hr><div class="details toc" id="toc-static"  data-kept="">
                    <div class="details-summary toc-title">
                        <span>ç›®å½•</span>
                        <span><i class="details-icon fa-solid fa-angle-right"></i></span>
                    </div>
                    <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#å¼•è¨€">å¼•è¨€</a></li>
    <li><a href="#æŒ‰è¡Œå­˜å‚¨ä¸æŒ‰åˆ—å­˜å‚¨">æŒ‰è¡Œå­˜å‚¨ä¸æŒ‰åˆ—å­˜å‚¨</a></li>
    <li><a href="#strides-æ ¼å¼">Strides æ ¼å¼</a></li>
    <li><a href="#why-strides">Why stridesï¼Ÿ</a>
      <ul>
        <li><a href="#print_internal-å‡½æ•°">print_internal å‡½æ•°</a></li>
        <li><a href="#permute-æ“ä½œ">permute æ“ä½œ</a></li>
        <li><a href="#broadcast_to-æ“ä½œ">broadcast_to æ“ä½œ</a></li>
        <li><a href="#reshape-æ“ä½œå’Œ-contiguous-æ“ä½œ">reshape æ“ä½œå’Œ contiguous æ“ä½œ</a></li>
      </ul>
    </li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
    <li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
  </ul>
</nav></div>
                </div><div class="content" id="content"><h2 id="å¼•è¨€">å¼•è¨€</h2>
<p>å°½ç®¡æˆ‘å·²ç»ä½¿ç”¨ Numpy å’Œ Pytorch å¥½é•¿ä¸€æ®µæ—¶é—´äº†ï¼Œä½†æˆ‘ä¸€ç›´ä¸çŸ¥é“ä»–ä»¬æ˜¯å¦‚ä½•å®ç°åº•å±‚çš„å¼ é‡ï¼ˆtensorï¼‰ï¼Œè€Œä¸”<strong>è¿™ä¹ˆé«˜æ•ˆ</strong>ã€‚æœ€è¿‘åœ¨çœ‹ <a href="https://dlsyscourse.org/" target="_blank" rel="noopener noreffer">Deep Learning Systems</a> è¿™é—¨è¯¾ï¼Œç»ˆäºæœ‰æœºä¼šå°è¯•è‡ªå·±å®ç°å¼ é‡ï¼Œå®ç°ä¸€éä¹‹åå¯¹å¼ é‡çš„ç†è§£æ›´æ·±åˆ»äº†ğŸ§</p>
<p>ä½œä¸º Pytorch çš„ä½¿ç”¨è€…æœ‰å¿…è¦ç†è§£åº•å±‚çš„å¼ é‡å­˜å‚¨åŸç†å—ï¼Ÿæˆ‘è§‰å¾—æ˜¯<strong>æœ‰å¿…è¦çš„</strong>ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ç†è§£åº•å±‚åŸç†éƒ½èƒ½è®©ä½ æ›´å¥½ç†è§£ä¸Šå±‚çš„ä¸œè¥¿ï¼Œ<em>æ¯”å¦‚ç†è§£å¼ é‡çš„å­˜å‚¨åŸç†ä¹‹åæœ‰åŠ©äºä½ ä¼šå›ç­”ä¸‹é¢è¿™å‡ ä¸ªé—®é¢˜</em></p>
<ul>
<li>å¹¿æ’­æ“ä½œæ¶‰åŠåˆ°æ•°ç»„çš„æ‹·è´å—ï¼Ÿ</li>
<li>Pytorch çš„ <code>contiguous</code> ä¸­æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå‡½æ•°ï¼Ÿ</li>
</ul>
<h2 id="æŒ‰è¡Œå­˜å‚¨ä¸æŒ‰åˆ—å­˜å‚¨">æŒ‰è¡Œå­˜å‚¨ä¸æŒ‰åˆ—å­˜å‚¨</h2>
<p>è®©æˆ‘ä»¬ä»ç®€å•çš„äºŒç»´æ•°ç»„å‡ºå‘ï¼Œ<strong>äºŒç»´æ•°ç»„åœ¨å†…å­˜ä¸­å æ®è¿ç»­çš„ä½ç½®</strong>ï¼Œä½†æ˜¯è¦æŒ‰è¡Œå­˜å‚¨è¿˜æ˜¯æŒ‰åˆ—å­˜å‚¨è¿™ç‚¹å¯èƒ½ä¸ç›¸åŒ</p>
<p><em>æ¯”å¦‚ç°åœ¨æœ‰ä¸‹é¢è¿™ä¸ª $2\times 3$ çš„äºŒç»´æ•°ç»„ <code>A</code></em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[[</span><span class="mf">0.2949</span><span class="p">,</span> <span class="mf">0.9608</span><span class="p">,</span> <span class="mf">0.0965</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"> <span class="p">[</span><span class="mf">0.5463</span><span class="p">,</span> <span class="mf">0.4176</span><span class="p">,</span> <span class="mf">0.8146</span><span class="p">]]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å¦‚æœæ˜¯æŒ‰è¡Œå­˜å‚¨</strong>ï¼Œé‚£ä¹ˆå†…å­˜ä¸­çš„æ’åˆ—ï¼ˆè¿™é‡Œè®°ä¸º <code>A_in_row</code>ï¼‰æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[</span><span class="mf">0.2949</span><span class="p">,</span> <span class="mf">0.9608</span><span class="p">,</span> <span class="mf">0.0965</span><span class="p">,</span> <span class="mf">0.5463</span><span class="p">,</span> <span class="mf">0.4176</span><span class="p">,</span> <span class="mf">0.8146</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>æŒ‰è¡Œå­˜å‚¨çš„æ—¶å€™ï¼Œè¦è®¿é—® <code>(i, j)</code> ä½ç½®çš„å€¼çš„å…¬å¼æ˜¯</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A_in_row</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ˜¯æŒ‰åˆ—å­˜å‚¨ï¼Œé‚£ä¹ˆå†…å­˜ä¸­çš„æ’åˆ—ï¼ˆè¿™é‡Œè®°ä¸º <code>A_in_col</code>ï¼‰æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[</span><span class="mf">0.2949</span><span class="p">,</span> <span class="mf">0.5463</span><span class="p">,</span> <span class="mf">0.9608</span><span class="p">,</span> <span class="mf">0.4176</span><span class="p">,</span> <span class="mf">0.0965</span><span class="p">,</span> <span class="mf">0.8146</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>æŒ‰åˆ—å­˜å‚¨çš„æ—¶å€™ï¼Œè¦è®¿é—® <code>(i, j)</code> ä½ç½®çš„å€¼çš„å…¬å¼æ˜¯</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A_in_col</span><span class="p">[</span><span class="n">j</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="strides-æ ¼å¼">Strides æ ¼å¼</h2>
<p>å¼ é‡åœ¨åº•å±‚å¯ä»¥æ˜¯æŒ‰è¡Œå­˜å‚¨ä¹Ÿå¯ä»¥æ˜¯æŒ‰åˆ—å­˜å‚¨ã€‚Numpy å’Œ Pytorch éƒ½é‡‡ç”¨äº†<strong>æŒ‰è¡Œå­˜å‚¨</strong>çš„æ–¹å¼ï¼Œ<strong>ä»»ä½•ç»´åº¦çš„å¼ é‡åœ¨åº•å±‚å­˜å‚¨éƒ½å æ®ç€å†…å­˜ä¸­è¿ç»­çš„ç©ºé—´</strong>ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬å¦‚ä½•è®¿é—®åˆ°æˆ‘ä»¬æƒ³è¦çš„ä½ç½®çš„æ•°æ®ï¼Ÿ</p>
<p>ç­”æ¡ˆå°±æ˜¯ <strong>strides æ ¼å¼</strong>ã€‚strides æ ¼å¼å¯ä»¥çœ‹æˆæ˜¯å‰é¢ä¸¤ç§ç´¢å¼•æ ¼å¼çš„æ³›åŒ–ç‰ˆæœ¬ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸€ä¸ª $N$ ç»´çš„å¼ é‡ <code>A</code>ï¼ˆå‡è®¾ç»´åº¦ä» 0 å¼€å§‹ï¼‰ï¼Œå®ƒçš„åº•å±‚å­˜å‚¨ä¸º <code>A_internal</code>ï¼Œæˆ‘ä»¬æƒ³è¦è®¿é—® <code>A[i0][i1][i2]...</code>ï¼Œé‚£ä¹ˆç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">A</span><span class="p">[</span><span class="n">i0</span><span class="p">][</span><span class="n">i1</span><span class="p">][</span><span class="n">i2</span><span class="p">]</span><span class="o">...</span> <span class="o">=</span> <span class="n">A_internal</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">stride_offset</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="n">i0</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="n">i1</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="n">i2</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="ow">in</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Strides æ ¼å¼æœ‰ä¸¤ä¸ªç»„æˆéƒ¨åˆ†</strong></p>
<ul>
<li><code>offset</code> - è¡¨ç¤ºå¼ é‡ç›¸å¯¹äºåº•å±‚å­˜å‚¨ <code>A_internal</code> çš„åç§»é‡</li>
<li><code>strides</code> æ•°ç»„ï¼Œ<strong>é•¿åº¦å’Œå¼ é‡çš„ç»´åº¦ä¸€æ ·</strong>ï¼Œ<code>strides[i]</code> è¡¨ç¤ºå¼ é‡åœ¨ç¬¬ $i$ ä¸ªç»´åº¦ä¸Šç§»åŠ¨â€œä¸€ä¸ªå•ä½â€éœ€è¦åœ¨å†…å­˜ä¸Šè·³è¿‡å¤šå°‘ä¸ªå…ƒç´ </li>
</ul>
<p><em>ä¸¾ä¾‹æ¥è¯´ï¼Œå‰é¢æåˆ°çš„äºŒç»´æ•°ç»„çš„ä¾‹å­ï¼Œå¦‚æœç”¨ strides çš„æ ¼å¼æ¥ç†è§£çš„è¯ï¼Œåº”è¯¥æ˜¯ä¸‹é¢è¿™æ ·</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A_in_row</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å³å¯¹äºä¸€ä¸ªå¤§å°ä¸º <code>(A.shape[0], A.shape[1])</code> çš„äºŒç»´æ•°ç»„ï¼Œå®ƒçš„ <code>offset</code> æ˜¯ <code>0</code>ï¼Œ<code>strides = [A.shape[1], 1]</code>(row-major)ã€‚ğŸ¤”ï¸ <em>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡åœ¨ç¬¬ä¸€ä¸ªç»´åº¦ä¸Šè¦è·³è·ƒâ€œä¸€ä¸ªå•ä½â€ï¼Œéœ€è¦è·³è¿‡åº•å±‚çš„ <code>A.shape[1]</code> ä¸ªå…ƒç´ ï¼Œ<code>A.shape[1]</code> ä¹Ÿå°±æ˜¯è¡Œçš„é•¿åº¦</em></p>
<blockquote>
<p>æˆ‘åšäº†ä¸‹é¢è¿™å¼ å›¾ç‰‡ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©ä½ ç†è§£ :)</p>
</blockquote>
<figure><img src="/img/2D_tensor_strides.png" width="resize"/>
</figure>

<p>ğŸ§ é‚£ä¹ˆå¦‚ä½•å¾—åˆ° $N$ ç»´å¼ é‡çš„ strides æ•°ç»„ï¼Ÿå‡è®¾è¦æ±‚è§£çš„æ˜¯ <code>strides[k]</code> å³ç¬¬ $k$ ä¸ªç»´åº¦çš„ strideï¼Œæˆ‘ä»¬çŸ¥é“å®ƒçš„è¯­ä¹‰æ˜¯ã€Œåœ¨ç¬¬ $k$ ç»´ä¸Šç§»åŠ¨â€œä¸€ä¸ªå•ä½â€éœ€è¦åœ¨å†…å­˜ä¸Šè·³è¿‡å¤šå°‘ä¸ªå…ƒç´ ã€ï¼Œ<strong>å¦‚æœè¿™ä¸ªå¼ é‡çš„åº•å±‚å­˜å‚¨åœ¨å†…å­˜ä¸Šæ˜¯è¿ç»­å­˜å‚¨ï¼ˆç´§å‡‘æ ¼å¼ï¼‰</strong>ï¼Œé‚£å°±æ˜¯ ã€Œ$k+1,k+2,&hellip;,N-1$ ç»´åº¦çš„å¤§å°çš„ä¹˜ç§¯ã€ï¼Œå¦‚æœ $k=N-1$ï¼Œé‚£ä¹ˆ <code>strides[N - 1] = 1</code></p>
<p>æ•°å­¦å…¬å¼å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼Œ
$$strides[k]=\prod_{i=k+1}^{N-1}shape[i]$$</p>
<blockquote>
<p>ğŸ’¡ å†æ¬¡å¼ºè°ƒï¼Œä¸Šé¢çš„å…¬å¼åªæœ‰åœ¨å¼ é‡çš„åº•å±‚å­˜å‚¨åœ¨å†…å­˜ä¸Šæ˜¯è¿ç»­å­˜å‚¨ï¼ˆç´§å‡‘æ ¼å¼ï¼‰çš„æ—¶å€™æˆç«‹</p>
</blockquote>
<h2 id="why-strides">Why stridesï¼Ÿ</h2>
<p>çŸ¥é“äº† strides çš„å­˜å‚¨æ ¼å¼ä¹‹åï¼Œ<strong>æˆ‘ä»¬è¿˜è¦ç†è§£ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡</strong>ï¼Œstrides ç©¶ç«Ÿç»™æˆ‘ä»¬å¸¦æ¥äº†ä»€ä¹ˆï¼Ÿ<strong>æœ€å¤§çš„å¥½å¤„æ˜¯ï¼šå¾ˆå¤šå…³äºå¼ é‡çš„æ“ä½œéƒ½å¯ä»¥æ˜¯é›¶æ‹·è´ï¼ˆZero-copyï¼‰çš„</strong>ã€‚é€šè¿‡ strides æ ¼å¼ï¼Œ<strong>ã€Œåº•å±‚å­˜å‚¨ã€å’Œã€Œè§†å›¾ã€ä¹‹é—´æ˜¯åˆ†ç¦»å¼€çš„</strong>ï¼Œä¸‹é¢æˆ‘æ¥è®²è§£ä¸€ä¸‹å‡ ä¸ªå¸¸è§çš„æ“ä½œ</p>
<h3 id="print_internal-å‡½æ•°">print_internal å‡½æ•°</h3>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªå‡½æ•°è·å– Pytorch çš„å¼ é‡åº•å±‚å­˜å‚¨</p>
<p>é¦–å…ˆæ˜¯ Pytorch æä¾›çš„ <code>data_ptr()</code> è¿™ä¸ªæ–¹æ³•ï¼Œä»–ä¼šè¿”å›å¼ é‡åº•å±‚å­˜å‚¨è¡¨ç¤ºçš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å†…å­˜åœ°å€</p>
<p>ç„¶åé€šè¿‡ Pytorch æä¾›çš„ <code>storage().nbytes()</code> å°±å¯ä»¥çŸ¥é“å¼ é‡çš„åº•å±‚å­˜å‚¨åœ¨å†…å­˜ä¸Šå æ®äº†å¤šå¤§çš„ç©ºé—´<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>ï¼Œè€Œå¼ é‡çš„ <code>dtype</code> å±æ€§åˆ™å‘Šè¯‰äº†æˆ‘ä»¬æ¯ä¸ªå…ƒç´ å æ®å¤šå¤§ï¼Œ<em>æ¯”å¦‚ <code>torch.float32</code> å°±æ˜¯ 4 ä¸ªå­—èŠ‚</em></p>
<p>æœ€åé€šè¿‡ <code>ctypes.string_at(address, size=-1)</code> å‡½æ•°å°±å¯ä»¥è¯»å–è¿™ä¸ªå¼ é‡ä¸º C çš„å­—ç¬¦ä¸²ï¼ˆbufferï¼‰ï¼Œè€Œ <code>torch.frombuffer</code> å¯ä»¥ä»ä¸€ä¸ª buffer åˆ›å»ºå‡º tensor</p>
<p>é€šè¿‡ä¸Šé¢å‡ ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿˜åŸå‡º Pytorch åº•å±‚çš„æ•°ç»„è¡¨ç¤ºï¼Œä¸‹é¢å‘½åä¸º <code>print_internal</code> å‡½æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_internal</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">torch</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">ctypes</span><span class="o">.</span><span class="n">string_at</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">data_ptr</span><span class="p">(),</span> <span class="n">t</span><span class="o">.</span><span class="n">storage</span><span class="p">()</span><span class="o">.</span><span class="n">nbytes</span><span class="p">()),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">dtype</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç»´åº¦ä¸º <code>(1, 2, 3, 4)</code> çš„å¼ é‡ <code>t</code> å¹¶è§‚å¯Ÿå®ƒçš„åº•å±‚è¡¨ç¤ºï¼Œ<strong>åé¢çš„æ“ä½œè®²è§£ä¼šåŸºäºè¿™ä¸ªå¼ é‡ <code>t</code></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># tensor([[[[ 0,  1,  2,  3],</span>
</span></span><span class="line"><span class="cl"><span class="c1">#           [ 4,  5,  6,  7],</span>
</span></span><span class="line"><span class="cl"><span class="c1">#           [ 8,  9, 10, 11]],</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#          [[12, 13, 14, 15],</span>
</span></span><span class="line"><span class="cl"><span class="c1">#           [16, 17, 18, 19],</span>
</span></span><span class="line"><span class="cl"><span class="c1">#           [20, 21, 22, 23]]]])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">stride</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (24, 12, 4, 1)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">print_internal</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># tensor([0,  1,  2,  3,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         4,  5,  6,  7,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         8,  9, 10, 11,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         12, 13, 14, 15,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         16, 17, 18, 19,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         20, 21, 22, 23])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŒ‰ç…§æˆ‘ä»¬å‰é¢è¯´çš„ä»å¼ é‡çš„ç»´åº¦æ¨å¯¼ stride çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸éš¾çŸ¥é“è¿™ä¸ª tensor çš„ stride åº”è¯¥æ˜¯ <code>(2 * 3 * 4, 3 * 4, 4, 1)</code> ä¹Ÿå°±æ˜¯ <code>(24, 12, 4, 1)</code></p>
<p>åœ¨ Pytorch é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ tensor çš„ <code>stride()</code> æ–¹æ³•è·å¾— strideï¼Œå¯ä»¥çœ‹åˆ°ï¼Œç¡®å®è·Ÿæˆ‘ä»¬æ‰‹åŠ¨è®¡ç®—å‡ºæ¥çš„ä¸€æ ·ğŸ¤”ï¸</p>
<h3 id="permute-æ“ä½œ">permute æ“ä½œ</h3>
<p>å‡è®¾æˆ‘ä»¬ç”¨ <code>permute</code> é‡æ–°æ’åˆ—äº†å„ä¸ªç»´åº¦ï¼Œé‚£ä¹ˆ <code>strides</code> å¦‚ä½•å˜åŒ–ï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">stride</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (24, 12, 4, 1)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">permute</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">is_contiguous</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">permute</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">stride</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (12, 4, 1, 24)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">print_internal</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">permute</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># tensor([0,  1,  2,  3,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         4,  5,  6,  7,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         8,  9, 10, 11,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         12, 13, 14, 15,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         16, 17, 18, 19,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         20, 21, 22, 23])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>permute</code> æ“ä½œæ˜¾ç„¶ä¸ä¼šå½±å“ <code>offset</code>ï¼Œ<strong>è€Œä¸”åº•å±‚å­˜å‚¨ä»ç„¶æ˜¯ç´§å‡‘çš„</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>permute</code> ä¹‹åçš„æ–°çš„ç»´åº¦ <code>new_shape</code> ç„¶åæ ¹æ®å®šä¹‰è®¡ç®—å‡º <code>strides</code>ï¼Œä½†æ˜¯<strong>æ›´å¿«çš„åŠæ³•æ˜¯ï¼Œç›´æ¥åœ¨ <code>strides</code> ä¸Šä¹Ÿåšä¸€æ ·çš„ <code>permute</code> æ“ä½œå³å¯</strong>ã€‚<code>print_internal</code> å‡½æ•°çš„è¾“å‡ºè¯æ˜äº†åº•å±‚å­˜å‚¨ç¡®å®æ²¡æœ‰å˜åŒ–ã€‚</p>
<h3 id="broadcast_to-æ“ä½œ">broadcast_to æ“ä½œ</h3>
<p>å¹¿æ’­æ“ä½œæ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ï¼Œåœ¨ä¸äº†è§£å¼ é‡çš„å­˜å‚¨åŸç†ä¹‹å‰ï¼Œä½ å¯èƒ½ä»¥ä¸ºå¹¿æ’­æ“ä½œå°±æ˜¯åœ¨å¯¹åº”çš„ç»´åº¦ä¸Šæ‹·è´å¤šä»½ï¼Œä½†å…¶å®ï¼Œ<strong>æ ¹æœ¬å°±æ²¡æœ‰å‘ç”Ÿæ‹·è´ï¼Œåªæ˜¯ä¿®æ”¹äº† <code>strides</code> æ•°ç»„çš„å€¼è€Œå·²</strong>ã€‚æ›´ç¡®åˆ‡æ¥è¯´ï¼ŒPytorch ä¼šæŠŠè¢«å¹¿æ’­çš„ç»´åº¦ï¼ˆæœ¬æ¥çš„ç»´åº¦å¤§å°æ˜¯ 1ï¼‰çš„ stride è®¾ç½®ä¸º 0<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<p><em>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ªç»´åº¦ä¸Šåšå¹¿æ’­ï¼Œè§‚å¯Ÿå¹¿æ’­ä¹‹åçš„ç»´åº¦å¤§å°ï¼Œä»¥åŠ strides æ•°ç»„çš„å˜åŒ–æƒ…å†µ</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">is_contiguous</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># torch.Size([2, 2, 3, 4])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">stride</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (24, 12, 4, 1)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">stride</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (0, 12, 4, 1)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">print_internal</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># tensor([0,  1,  2,  3,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         4,  5,  6,  7,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         8,  9, 10, 11,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         12, 13, 14, 15,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         16, 17, 18, 19,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         20, 21, 22, 23])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ä½ ï¼ˆå¯èƒ½ï¼‰ä¼šæƒŠè®¶åœ°å‘ç°</strong>ï¼ŒPytorch ç¡®å®æ²¡æœ‰åœ¨å¹¿æ’­çš„æ—¶å€™æ‹·è´å¯¹åº”ç»´åº¦çš„å¼ é‡ï¼Œä»…ä»…åªæ˜¯ä¿®æ”¹ <code>strides</code> æ•°ç»„äº†è€Œå·²ã€‚å›å¿† <code>strides[i]</code> çš„å«ä¹‰ï¼Œè¢«å¹¿æ’­çš„ç»´åº¦çš„ stride è®¾ç½®ä¸º <code>0</code> æ„å‘³ç€è¿™ä¸ªç»´åº¦ä¸Šç§»åŠ¨â€œä¸€ä¸ªå•ä½â€œå¹¶ä¸éœ€è¦åœ¨å†…å­˜ä¸Šè·³è¿‡å…ƒç´ ï¼Œ<strong>ä¹Ÿå°±æ˜¯åœ¨è¢«å¹¿æ’­çš„ç»´åº¦ä¸Šæˆ‘ä»¬ä¸€ç›´åœ¨è®¿é—®çš„æ˜¯åŒä¸€å—åŒºåŸŸ</strong></p>
<h3 id="reshape-æ“ä½œå’Œ-contiguous-æ“ä½œ">reshape æ“ä½œå’Œ contiguous æ“ä½œ</h3>
<p>ç´¢å¼•æ“ä½œå¯èƒ½ä¼šä¿®æ”¹ <code>offset</code>ï¼Œå› ä¸ºç´¢å¼•ä¹‹å<em>å½¢æˆçš„</em>å¼ é‡ä¸ä¸€å®šä»æœ¬æ¥åº•å±‚å­˜å‚¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼ŒåŒæ—¶ç´¢å¼•æ“ä½œå¯èƒ½ä¼šç´¢å¼•åˆ°<strong>åº•å±‚å­˜å‚¨ä¸­çš„ã€Œéè¿ç»­ã€éƒ¨åˆ†</strong>ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ç´¢å¼•æ“ä½œæ¥ç ”ç©¶ <code>reshape</code> æ“ä½œå’Œ <code>contiguous</code> æ“ä½œæ˜¯å¦‚ä½•èµ·ä½œç”¨çš„</p>
<p><em>ç°åœ¨å‡è®¾æˆ‘ä»¬æƒ³è¦ä» <code>t</code> æ‹¿åˆ°ä¸‹é¢è¿™ä¸ªå¼ é‡</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[[[</span><span class="mi">2</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">   <span class="mi">6</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">   <span class="mi">10</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="mi">14</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="mi">18</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="mi">22</span><span class="p">]]]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>å¯¹åº”çš„ç´¢å¼•æ“ä½œå¦‚ä¸‹</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="c1"># tensor([[[ 2,  6, 10],</span>
</span></span><span class="line"><span class="cl"><span class="c1">#          [14, 18, 22]]])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„åˆ°è¿™ä¸ªæ“ä½œåŒæ—¶ç¬¦åˆæˆ‘å‰é¢è¯´çš„ï¼š</p>
<ul>
<li><code>offset</code> æ”¹å˜äº†ï¼Œå› ä¸ºç°åœ¨æ˜¯ä» <code>2</code> è€Œä¸æ˜¯ä» <code>0</code> å¼€å§‹äº†</li>
<li>ç´¢å¼•åˆ°çš„å…ƒç´ åœ¨æœ¬æ¥çš„å†…å­˜ä¸Šä¸æ˜¯è¿ç»­çš„</li>
</ul>
<p><em>ä¸‹é¢çš„ä»£ç éªŒè¯äº†æˆ‘ä»¬çš„çŒœæƒ³</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">storage_offset</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">storage_offset</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">is_contiguous</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># False</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ç°åœ¨æ¥è§‚å¯Ÿåº•å±‚å­˜å‚¨</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">print_internal</span><span class="p">(</span><span class="n">t</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="c1"># tensor([        2,  3,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         4,  5,  6,  7,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         8,  9, 10, 11,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         12, 13, 14, 15,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         16, 17, 18, 19,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         20, 21, 22, 23</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         1152921504606846976, -8070441752123218147]])</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ignore the last row because t.data_ptr() has changed but t.storage().nbytes()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># kept the same.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># As a result, we read 2 invalid elements and get 2 meaningless values</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>Pytorch çš„å¼ é‡æœ‰ä¸ªæ–¹æ³•å«åš <code>storage_offset</code> å¯ä»¥æ‹¿åˆ°å¼ é‡ç›¸å¯¹äºåº•å±‚å­˜å‚¨çš„åç§»é‡ï¼Œå¯ä»¥çœ‹åˆ°ç°åœ¨ä»åº•å±‚å­˜å‚¨çš„ç¬¬äºŒä¸ªä½ç½®å¼€å§‹äº†ï¼Œç¬¬äºŒä¸ªä½ç½®æ°å¥½æ˜¯ <code>t[:, :, :, 2]</code> çš„ç¬¬ä¸€ä¸ªå…ƒç´  <code>2</code>ã€‚è€Œæ‰“å°å‡ºåº•å±‚å­˜å‚¨ä½ ä¼šå‘ç°ï¼Œåº•å±‚å­˜å‚¨è¿˜æ˜¯æœ¬æ¥çš„æ•°ç»„</em></p>
<blockquote>
<p>æ³¨æ„è¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ï¼Œå› ä¸ºåº•å±‚å­˜å‚¨æ²¡æœ‰å˜åŒ–ï¼Œ<code>t.storage().nbytes()</code> è·ŸåŸæ¥ä¸€æ ·ã€‚ä½†æ˜¯ <code>data_ptr()</code> ä¼šç»™æˆ‘ä»¬ç¬¬äºŒä¸ªå…ƒç´ çš„åœ°å€ï¼Œå¯¼è‡´æœ€å <code>print_internal</code> æ‰“å°åº•å±‚å­˜å‚¨çš„æ—¶å€™ä¼šå¤šæ‰“å° 2 ä¸ªæ— æ•ˆçš„ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢çš„æœ€åä¸€è¡Œï¼‰ï¼Œæ‰€ä»¥å¾—åˆ°äº† 2 ä¸ªæ²¡æœ‰æ„ä¹‰çš„æ•°å­—</p>
</blockquote>
<p>ğŸ¤”ï¸ <em>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°è¯•æ‰§è¡Œ <code>reshape(3, 2)</code> å¹¶è§‚å¯Ÿåº•å±‚å­˜å‚¨æƒ…å†µ</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">print_internal</span><span class="p">(</span><span class="n">t</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># tensor([        2,  3,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         4,  5,  6,  7,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         8,  9, 10, 11,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         12, 13, 14, 15,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         16, 17, 18, 19,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         20, 21, 22, 23</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         1152921504606846976, -8070441752123218147]])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><em><code>reshape</code> æ“ä½œä¹‹åå‘ç°åº•å±‚å­˜å‚¨è¿˜æ˜¯æ²¡æœ‰å˜åŒ–</em>ï¼Œè¿™æ°å¥½å¯¹åº”æ–‡æ¡£é‡Œé¢æ‰€è¯´çš„ï¼šå¯èƒ½çš„æƒ…å†µä¸‹ï¼Œ<code>reshape</code> ä¹‹åï¼Œè¿”å›çš„å¼ é‡<strong>å°½å¯èƒ½</strong>æ˜¯åŒä¸€ä»½å­˜å‚¨<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></p>
<p><em>ä½†å¦‚æœæˆ‘ä»¬æƒ³è¦ <code>reshape</code> ä¹‹åçš„å¼ é‡åœ¨åº•å±‚çš„å­˜å‚¨æ˜¯ç´§å‡‘çš„å‘¢ï¼Ÿæ­¤æ—¶å°±å¯ä»¥ç´§è·Ÿç€è°ƒç”¨ <code>contiguous</code> æ–¹æ³•</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">print_internal</span><span class="p">(</span><span class="n">t</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">contiguous</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># tensor([ 2,  6, 10, 14, 18, 22])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ğŸ˜º å¯ä»¥å‘ç°ï¼Œ<code>contiguous</code> ä¹‹åç¡®å®åº•å±‚å­˜å‚¨å°±ç´§å‡‘äº†ï¼Œæ­¤æ—¶çš„ strides æ•°ç»„åº”è¯¥ç¬¦åˆæˆ‘ä»¬å‰é¢æåˆ°çš„å…¬å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># before contiguous</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">stride</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (8, 4)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># after contiguous</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (3, 2)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span><span class="o">.</span><span class="n">stride</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (2, 1)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ğŸ§ ä¸€ä¸ªæ¯”è¾ƒ<strong>æœ‰æŒ‘æˆ˜æ€§</strong>çš„é—®é¢˜ï¼Œç´¢å¼•æ“ä½œä¼šå¦‚ä½•å½±å“ <code>strides</code>ï¼Ÿ</p>
<p><em>è®©æˆ‘ä»¬ä»¥åˆšæ‰çš„ç´¢å¼•æ“ä½œä¸ºä¾‹å­ï¼Œé¦–å…ˆï¼Œç´¢å¼•ä¹‹åå¾—åˆ°æ–°çš„ç»´åº¦åº”è¯¥æ˜¯ <code>(1, 2, 3)</code>ï¼Œæ˜¾ç„¶ <code>[:, :, :, 2]</code> è¿™æ ·çš„ç´¢å¼•å¯¼è‡´åº•å±‚å­˜å‚¨åœ¨å†…å­˜ä¸Šä¸ç´§å‡‘ï¼Œå› æ­¤è§„å¾‹ä¸é€‚ç”¨ï¼Œé‚£ä¹ˆåªèƒ½ä»å®šä¹‰ä¸Šå‡ºå‘ï¼Œå‡è®¾ <code>t[:, :, :, 2]</code> çš„ strides æ˜¯ <code>[x, y, z]</code></em></p>
<p><em>å…ˆè§‚å¯Ÿ <code>t[:, :, :, 2]</code> åŒ…å«å“ªä¸€äº›å…ƒç´ </em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="c1"># tensor([[[ 2,  6, 10],</span>
</span></span><span class="line"><span class="cl"><span class="c1">#          [14, 18, 22]]])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å› ä¸ºæˆ‘å®šä¹‰çš„å¼ é‡æ˜¯ä» 0 å¼€å§‹çš„æ•´æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥è§‚å¯Ÿå€¼çš„å˜åŒ–æ¥è®¡ç®— strides çš„å˜åŒ–</strong>ï¼ˆè¿™æ˜¯ä¸€ä¸ªå°æŠ€å·§ï¼‰</p>
<ul>
<li>å¯¹äº <code>z</code>ï¼Œä» <code>2 -&gt; 6 -&gt; 10</code>ï¼Œæ¯æ¬¡è·³è¿‡äº† 4 ä¸ªä½ç½®ï¼Œæ‰€ä»¥ <code>z = 4</code></li>
<li>å¯¹äº <code>y</code>ï¼Œ<code>2 -&gt; 14</code>ï¼Œ<code>6 -&gt; 18</code>ï¼Œ<code>10 -&gt; 22</code>ï¼Œæ¯æ¬¡éƒ½è·³è¿‡äº† 12 ä¸ªä½ç½®ï¼Œå› æ­¤ <code>y = 12</code></li>
<li>å¯¹äº <code>x</code>ï¼Œå› ä¸º<strong>åº•å±‚å­˜å‚¨å¹¶æ²¡æœ‰æ”¹å˜</strong>ï¼ŒåŸæœ¬çš„å¼ é‡ <code>t</code> çš„ <code>stride[0] = 24</code>ï¼Œ<strong>å¦‚æœå¼ é‡ <code>t</code> çš„ç¬¬ä¸€ä¸ªç»´åº¦ä¸æ˜¯ 1 è€Œæ˜¯ä¸€ä¸ªæ›´å¤§çš„å€¼ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¯æ¬¡ä¼šè·³è¿‡ <code>stride[0]</code> ä¸ªå…ƒç´ </strong>ï¼Œæ‰€ä»¥ <code>x = 24</code></li>
</ul>
<p>æ‰€ä»¥ <code>t[:, :, :, 2]</code> çš„ <code>strides</code> åº”è¯¥æ˜¯ <code>(24, 12, 4)</code></p>
<p><em>è®©æˆ‘ä»¬æ¥è°ƒç”¨ä¸€ä¸‹ API çœ‹è¿™æ˜¯å¦æ­£ç¡®</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">stride</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (24, 12, 4, 1)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stride</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (24, 12, 4)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># what if the first dimension is not 1 but 2?</span>
</span></span><span class="line"><span class="cl"><span class="n">another_t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">another_t</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="c1"># tensor([[[ 2,  6, 10],</span>
</span></span><span class="line"><span class="cl"><span class="c1">#          [14, 18, 22]],</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#         [[26, 30, 34],</span>
</span></span><span class="line"><span class="cl"><span class="c1">#          [38, 42, 46]]])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># you can see that 2 -&gt; 26, 6 -&gt; 30, 10 -&gt; 35</span>
</span></span><span class="line"><span class="cl"><span class="c1"># , so the stride[0] = 24 is true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>ä¸Šé¢çš„ä»£ç éªŒè¯äº†æˆ‘ä»¬çš„çŒœæƒ³</em></p>
<p>ä½†æ˜¯ï¼Œç´¢å¼•æ“ä½œå¯èƒ½è¿œè¿œæ¯”æˆ‘ä»¬è¿™é‡Œè®²è§£çš„ <code>[:, :, :, 2]</code> å¤æ‚å¾—å¤šï¼Œ<em>æ¯”å¦‚ <code>[2, 1:3, 1:6:3]</code> è¿™ç§</em>ï¼Œæ­¤æ—¶ <code>strides</code> å’Œ <code>offset</code> åˆè¯¥å¦‚ä½•å˜åŒ–ï¼Ÿè¿™é‡Œä¸å±•å¼€ï¼Œä½†æ˜¯å¯ä»¥æ”¾ä¸€ä¸ª<strong>æç¤º</strong>ï¼šæŠŠæ¯ä¸ªæ ¼å¼éƒ½å˜æˆ Python çš„ Slice å¯¹è±¡ï¼Œç„¶åä» <code>strides[i]</code> çš„å®šä¹‰å‡ºå‘è¿›è¡Œæ¨å¯¼</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒPytorch çš„å¼ é‡çš„ä¸å°‘æ“ä½œéƒ½æ˜¯é€šè¿‡æ”¹å˜ strides çš„ <code>offset</code> æˆ–ï¼ˆå’Œï¼‰<code>strides</code> æ•°ç»„å®ç°çš„ï¼Œ<strong>è¿™è®©å¾ˆå¤šæ“ä½œç»´æŒäº†é›¶æ‹·è´å¼€é”€ï¼Œå› æ­¤æ•ˆç‡ä¼šå¾ˆé«˜</strong>ï¼Œè€Œä¸”ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥æŠŠä¸å°‘å¼ é‡æ“ä½œå®ç°ä¸º Lazy çš„ã€‚ç†è§£ strides æ ¼å¼<strong>æœ‰åŠ©äºæ„å»ºå¼ é‡çš„ mental modelï¼Œå®ƒèƒ½å¤Ÿè®©ä½ æ›´å¥½ç†è§£å¼ é‡çš„æ“ä½œçš„ä»£ç </strong>ã€‚é¡ºä¾¿æ¨èä¸€ä¸‹è¿™ä¸ª<a href="https://youtu.be/7kclgMIcMq0" target="_blank" rel="noopener noreffer">è§†é¢‘</a>ï¼Œåœ¨è¿™ä¸ªè§†é¢‘ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä½•æ“çºµ strides æ¥å®ç°é«˜æ•ˆçš„å·ç§¯æ“ä½œ</p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å›ç­”å‰é¢æˆ‘æŠ›å‡ºçš„é—®é¢˜äº†ï¼š</p>
<ul>
<li>å¹¿æ’­æ“ä½œæ¶‰åŠåˆ°æ•°ç»„çš„æ‹·è´å—ï¼Ÿ
<ul>
<li>å¹¶æ²¡æœ‰æ‹·è´ï¼Œåªæ˜¯ä¿®æ”¹äº† <code>strides</code> æ•°ç»„</li>
</ul>
</li>
<li>Pytorch çš„ <code>contiguous</code> ä¸­æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå‡½æ•°ï¼Ÿ
<ul>
<li>å› ä¸º <code>contiguous</code> ä¹‹åï¼Œå¼ é‡çš„åº•å±‚å­˜å‚¨æ˜¯å†…å­˜ç´§å‡‘çš„ï¼Œè™½ç„¶æœ‰æ‹·è´çš„å¼€é”€ï¼Œä½†æ˜¯åç»­æ‰§è¡Œä¸€äº›å¼ é‡ç›¸å…³çš„æ“ä½œçš„æ—¶å€™<strong>å†…å­˜å±€éƒ¨æ€§ä¼šæ›´å¥½</strong></li>
</ul>
</li>
</ul>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://discuss.pytorch.org/t/tensor-type-memory-usage/150933" target="_blank" rel="noopener noreffer">Tensor type memory usage - Memory Format - PyTorch Forums</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://pytorch.org/docs/stable/generated/torch.Tensor.expand.html#torch.Tensor.expand" target="_blank" rel="noopener noreffer">torch.expand  - PyTorch 2.0 documentation</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p><a href="https://pytorch.org/docs/stable/generated/torch.reshape.html#torch.reshape" target="_blank" rel="noopener noreffer">torch.reshape â€” PyTorch 2.0 documentation</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</div><div class="post-footer" id="post-footer">
    <div class="post-info"><div class="post-info-tag"><span><a href="/zh-cn/tags/internal/">Internal</a>
                </span><span><a href="/zh-cn/tags/pytorch/">Pytorch</a>
                </span><span><a href="/zh-cn/tags/deep-learning/">Deep-Learning</a>
                </span></div><div class="post-info-line"><div class="post-info-mod">
                <span>æ›´æ–°äº 2023-07-14</span>
            </div><div class="post-info-mod"></div>
        </div><div class="post-info-share">
            <span><a href="#" onclick="return false;" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://martinlwx.github.io/zh-cn/how-to-reprensent-a-tensor-or-ndarray/" data-title="Pytorch å¼ é‡çš„ strides æ ¼å¼æ˜¯ä»€ä¹ˆ" data-hashtags="Internal,Pytorch,Deep-Learning"><i class="fa-brands fa-square-x-twitter fa-fw"></i></a><a href="#" onclick="return false;" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://martinlwx.github.io/zh-cn/how-to-reprensent-a-tensor-or-ndarray/" data-hashtag="Internal"><i class="fa-brands fa-facebook-square fa-fw"></i></a><a href="#" onclick="return false;" title="åˆ†äº«åˆ° Hacker News" data-sharer="hackernews" data-url="https://martinlwx.github.io/zh-cn/how-to-reprensent-a-tensor-or-ndarray/" data-title="Pytorch å¼ é‡çš„ strides æ ¼å¼æ˜¯ä»€ä¹ˆ"><i class="fa-brands fa-hacker-news fa-fw"></i></a><a href="#" onclick="return false;" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://martinlwx.github.io/zh-cn/how-to-reprensent-a-tensor-or-ndarray/" data-title="Pytorch å¼ é‡çš„ strides æ ¼å¼æ˜¯ä»€ä¹ˆ"><i class="fa-brands fa-line fa-fw"></i></a><a href="#" onclick="return false;" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://martinlwx.github.io/zh-cn/how-to-reprensent-a-tensor-or-ndarray/" data-title="Pytorch å¼ é‡çš„ strides æ ¼å¼æ˜¯ä»€ä¹ˆ"><i class="fa-brands fa-weibo fa-fw"></i></a></span>
        </div></div><div class="post-nav"><a href="/zh-cn/how-to-memorize-insertion-and-deletion-in-rb-tree/" class="prev" rel="prev" title="å¦‚ä½•è®°å¿†çº¢é»‘æ ‘çš„æ“ä½œ"><i class="fa-solid fa-angle-left fa-fw"></i>Previous Post</a>
            <a href="/zh-cn/a-trick-to-calculating-partial-derivatives-in-ml/" class="next" rel="next" title="æœºå™¨å­¦ä¹ æ±‚è§£æ¢¯åº¦çš„å°æŠ€å·§">Next Post<i class="fa-solid fa-angle-right fa-fw"></i></a></div></div>
</div><div id="comments" class="single-card"><div id="utterances"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">Utterances</a>.
            </noscript></div></article></div>
            </main>
            <footer class="footer"><div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.121.2">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/khusika/FeelIt" target="_blank" rel="noopener noreffer" title="FeelIt 1.0.2"><i class="fa-solid fa-hand-holding-heart fa-fw"></i> FeelIt</a>
        </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/zh-cn/">MartinLwx</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
</div>
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker
        .register('/sw.min.js?version=1.0.2', { scope: '/' })
        .then(() => {
            console.info('MartinLwx\u0027s Blog\u00A0Service Worker Registered');
        }, err => console.error('MartinLwx\u0027s Blog\u00A0Service Worker registration failed: ', err));

    navigator.serviceWorker
        .ready
        .then(() => {
            console.info('MartinLwx\u0027s Blog\u00A0Service Worker Ready');
        });
}
</script>
</footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fa-solid fa-chevron-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fa-solid fa-comment-alt fa-fw"></i>
            </a></div><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/autocomplete/autocomplete.min.js"></script><script src="/lib/lunr/lunr.min.js"></script><script src="/lib/lunr/lunr.stemmer.support.min.js"></script><script src="/lib/lunr/lunr.zh.min.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script src="/lib/katex/katex.min.js"></script><script src="/lib/katex/auto-render.min.js"></script><script src="/lib/katex/copy-tex.min.js"></script><script src="/lib/katex/mhchem.min.js"></script><script src="/lib/cookieconsent/cookieconsent.min.js"></script><script>window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":30},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":null,"lightTheme":"github-light","repo":"MartinLwx/martinlwx.github.io"}},"cookieconsent":{"content":{"dismiss":"åŒæ„","link":"äº†è§£æ›´å¤š","message":"æœ¬ç½‘ç«™ä½¿ç”¨ Cookies æ¥æ”¹å–„æ‚¨çš„æµè§ˆä½“éªŒ."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/zh-cn/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":30,"type":"lunr"}};</script><script src="/js/theme.min.js"></script></body></html>
